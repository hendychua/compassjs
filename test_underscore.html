<!DOCTYPE html>

<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Test View with UnderscoreJS</title>
	<meta name="author" content="Hendy Chua">
	<script src="jquery-1.10.2.js" type="text/javascript"></script>
	<script src="underscore.js" type="text/javascript"></script>
	<script type="text/javascript" src="model.js"></script>    
</head>
<body>
    <div id="special" style="width:100%;border:1px solid blue;">
    </div>
    
    <div id="list_movies" style="width:100%;border:1px solid red;">
    </div>

    <script type="text/template" id="single-movie-template">
        <h3><%= model.title %></h3>
        <h6><%= model.summary %></h6>
        <img class="myImage" src="<%= model.img_url %>">
    </script>
    
    <script type="text/template" id="list-movies-template">
        <% _.each(model, function(movie) { %>
            <div>
                <%= movie.obj.title %><br>
                avg score: <%= movie.obj.avg_score %><br>
                <img src="<%= movie.obj.img_url %>">
                <hr>
            </div>
        <% }); %>
    </script>

<script type="text/javascript">
    // examples of getting models and connecting to views with underscorejs templates
    
    var Movie = function(){};
    Movie.prototype = new Compass.Model("http://cs3213.herokuapp.com/movies");


    var SingleMovieView = function(){};
    SingleMovieView.prototype = new Compass.View({
        template: $("#single-movie-template"),
        events: {
            "click .myImage": function updateMovieEvent() {
                console.log("movie updated");
            }
        }
    });
    
    var ListMoviesView = function(){};
    ListMoviesView.prototype = new Compass.View({
        template: $("#list-movies-template")
    });
    
    var firstMovie = new Movie;
    var firstMovieView = new SingleMovieView;
    firstMovie.get({
        id: "4.json",
        success: function(data) {
            firstMovieView.bindModel(data);
            $("body").append(firstMovieView.render());
            firstMovieView.delegateEvents();        
        }
    });
    
    var secondMovie = new Movie;
    var secondMovieView = new SingleMovieView;
    // this example shows how a user can override the render function in the View object
    // to suit what he wants.
    secondMovieView.render = function() {
        var template = _.template(this.template.html(), {model: this.model});
        $("#special").append(template);
    };
    secondMovie.get({
        id: "5.json",
        success: function(data) {
            secondMovieView.bindModel(data);
            secondMovieView.render();
        }
    });
    
    var listMoviesView = new ListMoviesView;    
    var Movies = function(){};
    Movies.prototype = new Compass.Collection(Movie);
    
    var listOfMovies = new Movies;
    var additionalParams = {
        page: 6
    };
    listOfMovies.get({
        customUrl: "http://cs3213.herokuapp.com/movies.json",
        additionalParams: additionalParams,
        success: function(data) {
            listMoviesView.bindModel(data);
            $("#list_movies").append(listMoviesView.render());
        }
    });
</script>
</body>
</html>
