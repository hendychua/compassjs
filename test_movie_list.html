<!DOCTYPE html>

<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Movie List</title>
	<script src="jquery-1.10.2.js" type="text/javascript"></script>
	<script src="underscore.js" type="text/javascript"></script>
	<link href="css/bootstrap.css" rel="stylesheet">
	<link href="css/bootstrap-responsive.css" rel="stylesheet">
	<script type="text/javascript" src="model.js"></script>    
</head>

<body>


<!-- Navigation bar. common for all pages -->
<div id="wrapper" class="container">
    <div class="navbar navbar-inverse">
        <div class="navbar-inner navbar-fixed-top">
            <div class="container">
                <a id="movies_path" class="brand" href="/">movies@pyramid3213</a>
            </div>
        </div>
    </div>
</div>
<!-- End of navigation bar --> 
<div id="indexContainer" class="container">
    <div style="padding-top:3%;">
        <div class="page-header row">
            <h1 class="span10">Hot on Pyramid3213</h1>
            <a id="new-movie" class="btn btn-primary" href="#new_movie">Add new movie</a>
        </div>
    </div>
	<div class="row">  
		<div id="list_movies">
		</div>
	</div>
	<div id="pagination" class="row-fluid">
        <a id="prevLink">&lt;&lt; Prev</a> <a id="nextLink">Next &gt;&gt;</a>
    </div>
</div>


    <script type="text/template" id="list-movies-template">
        <% _.each(model, function(movie) { %>
		<div class="span4">
            <h3>
				<%if (movie.obj.title.length <= 16) { %>
					<%= movie.obj.title %>
				<%} else {%>
					<%= movie.obj.title.substring(0,13) + "..." %>
				<%}%>
            </h3>
			<img src="<%= movie.obj.img_url %>">
			<p>
                avg score: 
				<%if (movie.obj.avg_score != null) { %>
					<%=Math.round(movie.obj.avg_score  * 100) / 100%>
				<%} else {%>
					0.0
				<%}%>
			</p>
		</div>
        <% }); %>
    </script>
<!-- End of index page --> 

<script type="text/javascript">
    // examples of getting models and connecting to views with bindModel and bindElement
    
    var Movie = function(){};
    Movie.prototype = new Compass.Model("http://cs3213.herokuapp.com/movies");
    
    var ListMoviesView = function(){};
    ListMoviesView.prototype = new Compass.View({
        template: $("#list-movies-template")
    });
    
 
    
    var listMoviesView = new ListMoviesView;    
    var Movies = function(){};
    Movies.prototype = new Compass.Collection(Movie);
    
    var listOfMovies = new Movies;
    var additionalParams = {
        page: 1
    };
    listOfMovies.get({
        customUrl: "http://cs3213.herokuapp.com/movies.json",
        additionalParams: additionalParams,
        success: function(data) {
            listMoviesView.bindModel(data);
            listMoviesView.bindElement("#list_movies");
			listMoviesView.render();
        }
    });
	
	
</script>

</body>
